<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MEV8VPW64E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-MEV8VPW64E');
  </script>
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Simpli Safer | Uneducated Technology</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Simpli Safer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Follow a meandering career in tech…" />
<meta property="og:description" content="Follow a meandering career in tech…" />
<link rel="canonical" href="https://onthefritzz.com/simpli-safer/" />
<meta property="og:url" content="https://onthefritzz.com/simpli-safer/" />
<meta property="og:site_name" content="Uneducated Technology" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-10-17T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Simpli Safer" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-17T00:00:00-05:00","datePublished":"2022-10-17T00:00:00-05:00","description":"Follow a meandering career in tech…","headline":"Simpli Safer","mainEntityOfPage":{"@type":"WebPage","@id":"https://onthefritzz.com/simpli-safer/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://onthefritzz.com/images/ij-logo-round.png"}},"url":"https://onthefritzz.com/simpli-safer/"}</script>
<!-- End Jekyll SEO tag -->


  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/skins/dark.css">
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i|Lora:400,400i,700,700i">
  <link rel="alternate" type="application/atom+xml" title="Uneducated Technology" href="/feed.xml">
<!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>


  <body class="layout--post  simpli-safer">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/stats/">Stats</a></li><li><a href="/">Posts</a></li><li><a href="/tags/">Tags</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
      <a href="/" class="site-logo" rel="home" title="Uneducated Technology">
        <img src="/images/ij-logo-round.png" class="site-logo-img animated fadeInDown" alt="Uneducated Technology">
      </a>
    
    
    
      
        <div class="site-title animated fadeIn"><a href="/">Uneducated Technology</a></div>
      
      <p class="site-description animated fadeIn" itemprop="description">Follow a meandering career in tech...</p>
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">Simpli Safer
</h1>
        
      </header>

      <div class="page-sidebar">
        <div class="page-author h-card p-author"><div class="author-info"><ul class="author-links"><li class="author-link">
            <a class="u-url" rel="me" href=""><i class="fas fa-link fa-lg" title=""></i></a>
          </li></ul>
    <time class="page-date dt-published" datetime="2022-10-17T00:00:00-05:00"><a class="u-url" href="">October 17, 2022</a>
</time>

  </div>
</div>

        

        
  <h3 class="page-taxonomies-title">Tags</h3>
  
  <ul class="page-taxonomies"><li class="page-taxonomy">Automation</li><li class="page-taxonomy">Python</li><li class="page-taxonomy">Selenium</li><li class="page-taxonomy">Webscraping</li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <p><img src="/images/personal/simplisafer.PNG" alt="no-alignment" /></p>

<p>Overview:</p>

<p>Got a new home security but it does not support scheduling. Uhhh…. python and selenium please.</p>

<p>Primary task is to automatically engage alarm in “Home” status around bedtime. Additional features include never having to manually change the alarm status. Ensuring that the alarm isn’t accidentally left “OFF”, while “AWAY”. Turning the alarm “OFF” before the first person leaves for the day, which doubles as a morning alert. Consequently, has also provided a 3x alert that indicates when an individual may be running late.</p>

<p>This is accomplished by running a script every 5, 10 or 15 minutes to check current time. Then, depending on certain time windows, automate the SimpliSafe browser UI to login to the account, navigate it’s portal, change alarm mode and end the browser session.</p>

<p>Script Tasks:</p>
<ul>
  <li>Determine current time every X minutes and execute tasks</li>
  <li>Login to SimpliSafe account via chrome browser</li>
  <li>Use Chrome Profile so that ‘Remember Me’ settings are saved between insances</li>
  <li>Provide OneTimePassword prompt for when SimpliSafe requires reauthorization</li>
  <li>Scrape current alarm state within portal</li>
  <li>Determine which state the alarm should be in based on routine</li>
  <li>If the state that the alarm <em>should</em> be in, is different from current alarm state, <em>click</em> the button to engage alarm
    <ul>
      <li>Getting current alarm status is necessary because the system can be set from “Home” to “Home” or “OFF” to “OFF” and an audible notification would happen every X minutes, otherwise.</li>
    </ul>
  </li>
  <li>Create log of alarm status and script information</li>
  <li>Accidentally had a rogue try/except, which prevented Selenium from ending some sessions. Resulting, in dozens of unused and hidden chrome instances running in the background and tapping out system resources.
    <ul>
      <li>This has been fixed, needless to say</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>

<span class="k">class</span> <span class="nc">autoSimpli</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">webdriverDirectory</span> <span class="o">=</span> <span class="s">''</span> <span class="c1"># %USERPROFILE%\\chromedriver.exe
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="s">''</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">passwd</span> <span class="o">=</span> <span class="s">''</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">logname</span> <span class="o">=</span> <span class="s">''</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">headless</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">otpPrompt</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
    <span class="n">options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--user-data-dir=C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">ijj</span><span class="se">\\</span><span class="s">AppData</span><span class="se">\\</span><span class="s">Local</span><span class="se">\\</span><span class="s">Google</span><span class="se">\\</span><span class="s">Chrome</span><span class="se">\\</span><span class="s">User Data</span><span class="se">\\</span><span class="s">"</span><span class="p">)</span> <span class="c1"># %USERPROFILE%\\AppData\\Local\\Google\\Chrome\\User Data\\
</span>    <span class="n">options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--profile-directory=Profile 1"</span><span class="p">)</span>
    <span class="n">options</span><span class="p">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s">"excludeSwitches"</span><span class="p">,</span> <span class="p">[</span><span class="s">"enable-logging"</span><span class="p">])</span> <span class="c1"># Silence Selenium's default "Getting default [bluetooth] adapter failed" error.
</span>    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">headless</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--headless"</span><span class="p">)</span>
    <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">webdriverDirectory</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">alarmLog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="p">.</span><span class="n">today</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%m.%d.%Y'</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">debug</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">note</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'DEBUG: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">debug</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">note</span><span class="si">}</span><span class="s">'</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">note</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">note</span><span class="si">}</span><span class="s">'</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">logname</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">a</span><span class="p">:</span>
      <span class="n">a</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">note</span><span class="si">}</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
      <span class="k">print</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://webapp.simplisafe.com/new/#/login"</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Navigating to login page...'</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Try normal login likely due to session expiration. ie: No OTP Prompt.
</span>      <span class="c1">#unameID = 'username'
</span>      <span class="n">pwdID</span> <span class="o">=</span> <span class="s">'/html/body/main/section/div/div/div/form/div[1]/div/div[2]/div/input'</span>
      <span class="n">loginButton</span> <span class="o">=</span> <span class="s">'/html/body/main/section/div/div/div/form/div[2]/button'</span><span class="c1">#'/html/body/div/div/div/main/section/div/div/div/form/div[2]/button'
</span>      <span class="n">welcomeEmail</span> <span class="o">=</span> <span class="s">'/html/body/main/section/div/div/div/form/div[1]/div/div/div/input'</span>
      <span class="n">welcomeButton</span> <span class="o">=</span> <span class="s">'/html/body/main/section/div/div/div/form/div[2]/button'</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">welcomeButton</span><span class="p">)))</span> <span class="c1"># XPATH for normal login page detected...
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">welcomeEmail</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">welcomeEmail</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">welcomeButton</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

      <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">loginButton</span><span class="p">)))</span> <span class="c1"># XPATH for normal login page detected...
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Login expired. Reconnecting...'</span><span class="p">)</span> 
      <span class="c1">#self.driver.find_element(By.ID, unameID).click() # Click user name field
</span>      <span class="c1">#self.driver.find_element(By.ID, unameID).send_keys(self.user) # Send user name credential
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">pwdID</span><span class="p">).</span><span class="n">click</span><span class="p">()</span> <span class="c1"># Click password field
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">pwdID</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">passwd</span><span class="p">)</span> <span class="c1"># Send password credential
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">loginButton</span><span class="p">).</span><span class="n">click</span><span class="p">()</span> <span class="c1"># Click Login Button
</span>    
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Previous session still live...'</span><span class="p">)</span>
      <span class="k">pass</span>

    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">otpPrompt</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span> <span class="c1"># Verify if prompted for OTP...
</span>        <span class="n">otpID</span> <span class="o">=</span> <span class="s">'code'</span>
        <span class="n">otpPath</span> <span class="o">=</span> <span class="s">'/html/body/main/section/div/div/div/div[1]/div/form/div[3]/button'</span>
        <span class="n">rememberPath</span> <span class="o">=</span> <span class="s">'/html/body/main/section/div/div/div/div[1]/div/form/div[2]/label'</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">otpID</span><span class="p">)))</span> <span class="c1"># XPATH for otp button detected...
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Prompted for reauthorization...'</span><span class="p">)</span>

        <span class="n">otpPin</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'OTP Pin: '</span><span class="p">)</span> <span class="c1"># Get end user input from 2AUTH notification
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">otpID</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">otpID</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="n">otpPin</span><span class="p">)</span> <span class="c1"># Enter end user input into field corresponding to OTP
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">rememberPath</span><span class="p">).</span><span class="n">click</span><span class="p">()</span> <span class="c1"># Click checkbox to 'trust' device for 30 days
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">otpPath</span><span class="p">).</span><span class="n">click</span><span class="p">()</span> <span class="c1"># Click 'Continue' button
</span>      <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Already trusted device...'</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Detect if logged in to home page
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Detecting log in status...'</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">statusPath</span> <span class="o">=</span> <span class="s">"/html/body/ss-root/div/ss-navigation/div[5]/ss-dashboard/div/div/div[2]/div[1]/div[1]/div/ss-recent-event-message"</span> <span class="c1"># 2nd element down from line break above status text ~ &lt;ss-recent-event-message _ngcontent-fcx-c117="" _nghost-fcx-c113=""&gt;
</span>      <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">statusPath</span><span class="p">)))</span> <span class="c1"># Wait for status path to become present. ie: If present, login complete.
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Login successful!'</span><span class="p">)</span>
    
    <span class="k">except</span><span class="p">:</span> <span class="c1"># None of the previous prompts were successful. Now you gotta find why an error that shouldn't occur, did.
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Login was *not* successful...'</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">setAlarm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">triggerState</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">statusPath</span><span class="p">).</span><span class="n">text</span> <span class="c1"># Scrape plain text related to alarm state status
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="sa">f</span><span class="s">'Status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s"> - Trigger: </span><span class="si">{</span><span class="n">triggerState</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">triggerState</span> <span class="o">==</span> <span class="s">'OFF'</span><span class="p">:</span> <span class="c1"># Change target button path depending on trigger state
</span>      <span class="n">buttonPath</span> <span class="o">=</span> <span class="s">"/html/body/ss-root/div/ss-navigation/div[5]/ss-dashboard/div/div/div[2]/ss-system-state-controls/div/div/div[1]"</span>
    <span class="k">elif</span> <span class="n">triggerState</span> <span class="o">==</span> <span class="s">'HOME'</span><span class="p">:</span>
      <span class="n">buttonPath</span> <span class="o">=</span> <span class="s">"/html/body/ss-root/div/ss-navigation/div[5]/ss-dashboard/div/div/div[2]/ss-system-state-controls/div/div/div[2]"</span>
    <span class="k">elif</span> <span class="n">triggerState</span> <span class="o">==</span> <span class="s">'AWAY'</span><span class="p">:</span>
      <span class="n">buttonPath</span> <span class="o">=</span> <span class="s">"/html/body/ss-root/div/ss-navigation/div[5]/ss-dashboard/div/div/div[2]/ss-system-state-controls/div/div/div[3]"</span>
    <span class="k">elif</span> <span class="n">triggerState</span> <span class="o">==</span> <span class="s">'LOG'</span><span class="p">:</span>
      <span class="k">raise</span> <span class="nb">Exception</span> <span class="c1"># Write alarm status to log but raise name error to break while loop in parent class outside function.
</span>
    <span class="k">if</span> <span class="s">'Master PIN'</span> <span class="ow">in</span> <span class="n">status</span> <span class="ow">and</span> <span class="n">override</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Master Pin Present. Manual Override.'</span><span class="p">)</span>
      <span class="k">pass</span> <span class="c1"># If last update was manual, do not automate change. ie: Someone disabled in afternoon.
</span>
    <span class="k">elif</span> <span class="n">override</span> <span class="o">==</span> <span class="s">'Notify'</span><span class="p">:</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">buttonPath</span><span class="p">).</span><span class="n">click</span><span class="p">()</span> <span class="c1"># Redundantly click off for notification.
</span>      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="sa">f</span><span class="s">'*NOTIFY* Button clicked: </span><span class="si">{</span><span class="n">triggerState</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="s">'disarmed'</span> <span class="ow">in</span> <span class="n">status</span> <span class="ow">and</span> <span class="n">triggerState</span> <span class="o">!=</span> <span class="s">'OFF'</span><span class="p">:</span> <span class="c1"># Do not *click* a state that alarm is already in. 
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">buttonPath</span><span class="p">).</span><span class="n">click</span><span class="p">()</span> <span class="c1"># *click* button corresponding to trigger state
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="sa">f</span><span class="s">'Button clicked: </span><span class="si">{</span><span class="n">triggerState</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    
      <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">stat</span> <span class="ow">in</span> <span class="n">status</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'armed'</span><span class="p">,</span> <span class="s">'Home'</span><span class="p">])</span> <span class="ow">and</span> <span class="n">triggerState</span> <span class="o">!=</span> <span class="s">'HOME'</span><span class="p">:</span> <span class="c1"># Do not *click* a state that alarm is already in.
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">buttonPath</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="sa">f</span><span class="s">'Button clicked: </span><span class="si">{</span><span class="n">triggerState</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
  
      <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">stat</span> <span class="ow">in</span> <span class="n">status</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'armed'</span><span class="p">,</span> <span class="s">'Away'</span><span class="p">])</span> <span class="ow">and</span> <span class="n">triggerState</span> <span class="o">!=</span> <span class="s">'AWAY'</span><span class="p">:</span> <span class="c1"># Do not *click* a state that alarm is already in.
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">buttonPath</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="sa">f</span><span class="s">'Button clicked: </span><span class="si">{</span><span class="n">triggerState</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="sa">f</span><span class="s">'Trigger State == Current Status'</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Wait for *click* to be processed/sent to server
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">alarmSchedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">weekday</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">dt</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">weekday</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">else</span> <span class="bp">False</span> <span class="c1"># Weekday = True, Weekend = False
</span>    <span class="k">try</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">now</span> <span class="o">&gt;</span> <span class="s">'22:30:00'</span> <span class="ow">or</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="s">'07:09:59'</span><span class="p">:</span> <span class="c1"># Sleeping =&gt; HOME
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="s">'HOME'</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># Always set to home status during 'sleep' hours
</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">weekday</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="c1"># Automate nothing on weekend. All Manual.
</span>          <span class="k">if</span> <span class="n">now</span> <span class="o">&gt;</span> <span class="s">'07:10:00'</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="s">'07:30:00'</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="s">'OFF'</span><span class="p">)</span> <span class="c1"># Will change status to off *once*, after 0710 morning window.
</span>          <span class="k">else</span><span class="p">:</span> <span class="c1"># Outside of sleep/wake cycle, do nothing. Fully manual.
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="s">'LOG'</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">now</span> <span class="o">&gt;</span> <span class="s">'07:10:00'</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="s">'08:29:59'</span> <span class="ow">and</span> <span class="n">weekday</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># Turn off during weekly morning routine, before leaving.
</span>          <span class="bp">self</span><span class="p">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="s">'OFF'</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">now</span> <span class="o">&gt;</span> <span class="s">'08:33:00'</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="s">'08:44:00'</span> <span class="ow">and</span> <span class="n">weekday</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># Redundantly force off so that audible notification is triggered.
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="s">'OFF'</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="s">'Notify'</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">now</span> <span class="o">&gt;</span> <span class="s">'09:05:00'</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="s">'09:45:00'</span> <span class="ow">and</span> <span class="n">weekday</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># Ignore manual entry for 45min and force away status if gone but not set.
</span>          <span class="bp">self</span><span class="p">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="s">'AWAY'</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">now</span> <span class="o">&gt;</span> <span class="s">'09:45:00'</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="s">'22:29:59'</span><span class="p">:</span> <span class="c1"># All trigger windows have been passed and should have been automated.
</span>          <span class="bp">self</span><span class="p">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="s">'LOG'</span><span class="p">)</span> <span class="c1"># If manually disabled then no reason to change anything. Log status for potential future debugging
</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
          <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="s">'Error should not have occurred or time between 8:44:01-9:04:59.'</span><span class="p">)</span>
          
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">alarmLog</span><span class="p">(</span><span class="sa">f</span><span class="s">'Manual exception raised inside setAlarm()'</span><span class="p">)</span> <span class="c1"># Only log needed but setAlarm function called to ensure alarm status matched.
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
  <span class="n">now</span> <span class="o">=</span> <span class="n">dt</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%H:%M:%S'</span><span class="p">)</span> <span class="c1"># Get current time
</span>  <span class="n">sim</span> <span class="o">=</span> <span class="n">autoSimpli</span><span class="p">()</span> <span class="c1"># Initialize webdriver
</span>  <span class="n">sim</span><span class="p">.</span><span class="n">login</span><span class="p">()</span> <span class="c1"># Attempt login, if necessary
</span>  <span class="n">sim</span><span class="p">.</span><span class="n">alarmSchedule</span><span class="p">()</span> <span class="c1"># Determine time and arm alarm accordingly
</span></code></pre></div></div>

        </div>

        
          <!--<div class="page-share">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fonthefritzz.com%2Fsimpli-safer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--facebook btn--small"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> <span>Share</span></a>
  <a href="https://twitter.com/intent/tweet?text=Simpli+Safer%20https%3A%2F%2Fonthefritzz.com%2Fsimpli-safer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--twitter btn--small"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fonthefritzz.com%2Fsimpli-safer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--linkedin btn--small"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=Simpli+Safer&url=https%3A%2F%2Fonthefritzz.com%2Fsimpli-safer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--reddit btn--small"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> <span>Reddit</span></a>
</div>-->

        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/i-am-groot/">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> I AM g-ROOT

      </span>
    </a>
  

  
    <a class="page-next" href="/googleNotesToThermal/">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Huge script, little guy
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="copyright">
    
      <p>&copy; 2024 Uneducated Technology. <br> Powered by <a href="https://www.vultr.com/">Vultr</a>, <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> and <a href="https://mademistakes.com/"> mademistakes </a></p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script><!---->


  </body>

</html>
